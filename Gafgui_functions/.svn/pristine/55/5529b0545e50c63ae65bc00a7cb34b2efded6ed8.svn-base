function [Ax,Bx,Cx,Ay,By,Cy,Az,Bz,Cz] = fct_GetCoeffMultich(rmat,gmat,bmat,DOSE,opt);
% function [Ax,Bx,Cx,Ay,By,Cy,Az,Bz,Cz,Axhat,Bxhat,Cxhat,Ayhat,Byhat,Cyhat,Azhat,Bzhat,Czhat] = fct_GetCoeffMultich(rmat,gmat,bmat,DOSE);
nbfilms = length(DOSE);

Ax = zeros(nbfilms,1); Bx = zeros(nbfilms,1); Cx = zeros(nbfilms,1);
Ay = zeros(nbfilms,1); By = zeros(nbfilms,1); Cy = zeros(nbfilms,1);
Az = zeros(nbfilms,1); Bz = zeros(nbfilms,1); Cz = zeros(nbfilms,1);
for i=1:nbfilms
    [m,n] = size(rmat{i});
    if opt
        asol = fct_solve_abc_simple(reshape(rmat{i},m*n,1));
        Ax(i) = asol(1); Bx(i) = asol(2); Cx(i) = asol(3);
        asol = fct_solve_abc_simple(reshape(gmat{i},m*n,1));
        Ay(i) = asol(1); By(i) = asol(2); Cy(i) = asol(3);
        asol = fct_solve_abc_simple(reshape(bmat{i},m*n,1));
        Az(i) = asol(1); Bz(i) = asol(2); Cz(i) = asol(3);
    else
        asol = fct_solve_abc_approx(reshape(rmat{i},m*n,1));
        Ax(i) = asol(1); Bx(i) = asol(2); Cx(i) = asol(3);
        asol = fct_solve_abc_approx(reshape(gmat{i},m*n,1));
        Ay(i) = asol(1); By(i) = asol(2); Cy(i) = asol(3);
        asol = fct_solve_abc_approx(reshape(bmat{i},m*n,1));
        Az(i) = asol(1); Bz(i) = asol(2); Cz(i) = asol(3);    
    end
end
% 
% 
% %Fitting coefficients versus dose just to show behaviour
% NA = min(4,length(DOSE)-1);
% NB = min(2,length(DOSE)-1);
% NC = min(1,length(DOSE)-1);
% 
% pAx = polyfit(DOSE,Ax,NA); pAy = polyfit(DOSE,Ay,NA); pAz = polyfit(DOSE,Az,NA);
% pBx = polyfit(DOSE,Bx,NB); pBy = polyfit(DOSE,By,NB); pBz = polyfit(DOSE,Bz,NB);
% pCx = polyfit(DOSE,Cx,NC); pCy = polyfit(DOSE,Cy,NC); pCz = polyfit(DOSE,Cz,NC);
% Axhat = polyval(pAx,DOSE); Ayhat = polyval(pAy,DOSE); Azhat = polyval(pAz,DOSE);
% Bxhat = polyval(pBx,DOSE); Byhat = polyval(pBy,DOSE); Bzhat = polyval(pBz,DOSE);
% Cxhat = polyval(pCx,DOSE); Cyhat = polyval(pCy,DOSE); Czhat = polyval(pCz,DOSE);