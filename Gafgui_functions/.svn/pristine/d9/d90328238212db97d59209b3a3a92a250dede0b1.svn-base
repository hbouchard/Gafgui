% --------------------------------------------------------------------
function h = fct_updatedisplay(handles)

color = fct_MODEtocolor(fct_colortochannel(handles.defaultchannel));

if min(size(handles.z))==0
    himage = imagesc(handles.z);
    set(gcf,'Color',color);
    axis('off');
    %pixval (gca,'off');
else
    nlines = size(handles.z,1);
    ncols = size(handles.z,2);
    [x,y] = fct_gridindextopos(nlines,ncols,handles.DELTA);
    x = x - handles.ORIGIN(1);
    y = y - handles.ORIGIN(2);
    axis('on');
    himage = imagesc(x,y,handles.z);
    set(gcf,'Color',color);
    vect1 = [handles.gridres*ceil(min(x)/handles.gridres)-handles.gridres:handles.gridres:handles.gridres*floor(max(x)/handles.gridres)+handles.gridres];
    vect2 = [handles.gridres*ceil(min(y)/handles.gridres)-handles.gridres:handles.gridres:handles.gridres*floor(max(y)/handles.gridres)+handles.gridres];
    set(gca,'DataAspectRatio',[1 1 1],'Xtick',vect1,'Ytick',vect2);
    set(gcf,'Units','pixels');
    colormap(handles.color);
    htext = impixelinfoval(gcf,himage);
    %set(htext,'FontWeight','bold');
    set(htext,'FontSize',10);
    %pixval(gca,'on');
    colorbar('vert');
    title((fct_guiinfo(handles)));
    if handles.gridflag == 1
        grid on;
    else
        grid off;
    end
end
h = gcf;