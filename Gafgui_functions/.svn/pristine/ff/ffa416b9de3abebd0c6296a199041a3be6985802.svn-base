function [Ax,Bx,Cx,Ay,By,Cy,Az,Bz,Cz] = fct_GetCoeffMultich2(rmat,gmat,bmat,DOSE,opt);

nbfilms = length(DOSE);

Ax = zeros(nbfilms,1); Bx = zeros(nbfilms,1); Cx = zeros(nbfilms,1);
Ay = zeros(nbfilms,1); By = zeros(nbfilms,1); Cy = zeros(nbfilms,1);
Az = zeros(nbfilms,1); Bz = zeros(nbfilms,1); Cz = zeros(nbfilms,1);

%first the average
for i=1:nbfilms
    [m,n] = size(rmat{i});
    r = reshape(rmat{i},m*n,1);
    g = reshape(gmat{i},m*n,1);
    b = reshape(bmat{i},m*n,1);
    Ax(i)= mean(r);  
    Ay(i)= mean(g); 
    Az(i)= mean(b);
end
%we fit
px = polyfit(DOSE,Ax,min(4,nbfilms-2));
py = polyfit(DOSE,Ay,min(4,nbfilms-2));
pz = polyfit(DOSE,Az,min(4,nbfilms-2));
%we use the estimated values
Ax = polyval(px,DOSE);
Ay = polyval(py,DOSE);
Az = polyval(pz,DOSE);
%second the std
for i=1:nbfilms
    [m,n] = size(rmat{i});
    r = reshape(rmat{i},m*n,1)-Ax(i);
    g = reshape(gmat{i},m*n,1)-Ay(i);
    b = reshape(bmat{i},m*n,1)-Az(i);
    Bx(i)= std(r);  
    By(i)= std(g); 
    Bz(i)= std(b);
end
%we fit
px = polyfit(DOSE,Bx,min(2,nbfilms-2));
py = polyfit(DOSE,By,min(2,nbfilms-2));
pz = polyfit(DOSE,Bz,min(2,nbfilms-2));
%we use the estimated values
Bx = polyval(px,DOSE);
By = polyval(py,DOSE);
Bz = polyval(pz,DOSE);
%third the skewness
for i=1:nbfilms
    [m,n] = size(rmat{i});
    r = (reshape(rmat{i},m*n,1)-Ax(i))/Bx(i);
    g = (reshape(gmat{i},m*n,1)-Ay(i))/By(i);
    b = (reshape(bmat{i},m*n,1)-Az(i))/Bz(i);
    Cx(i)= skewness(r);  
    Cy(i)= skewness(g); 
    Cz(i)= skewness(b);
end
Cx = Cx.*Bx/6;
Cy = Cy.*By/6;
Cz = Cz.*Bz/6;
%we fit
px = polyfit(DOSE,Cx,min(1,nbfilms-2));
py = polyfit(DOSE,Cy,min(1,nbfilms-2));
pz = polyfit(DOSE,Cz,min(1,nbfilms-2));
%we use the estimated values
Cx = polyval(px,DOSE);
Cy = polyval(py,DOSE);
Cz = polyval(pz,DOSE);